import{d as Z,r as D,M as re,a as I,u as e,N as de,w as l,b as t,h as j,e as q,f as ee,g as d,t as T,O as te,P as U,G as ae,i as m,v as S,C as x,Q as J,x as ce,y as pe,z as K,R as Q,p as _,S as V,s as W,F as E,q as L,T as me,A as y,U as le,V as fe,W as X,J as p,X as ge,Y as ve,Z as ye,$ as he,c as Ie,I as _e,a0 as Te,a1 as ke,m as Ce,a2 as De,a3 as we,a4 as be,a5 as Ve,l as $e,a6 as Fe,a7 as Y,a8 as Se,a9 as xe}from"./index-D7M7G7ZL.js";import{u as ne,_ as oe}from"./_plugin-vue_export-helper-C3Z-fnCw.js";import{r as Be,u as se,F as $,D as F}from"./useTasks-D7itPPa9.js";const Oe=Be("FileOpener"),Pe={class:"rich-input-wrapper"},Me={class:"rich-container"},Ne={key:0,class:"attachments-area"},Ue=["onClick"],Le={class:"chip-text"},Re=["onClick"],ze={class:"rich-toolbar"},Ge={key:0,class:"placeholder-text"},Ae=Z({__name:"TaskModal",props:{isOpen:{type:Boolean},editingId:{},initialData:{}},emits:["close","save"],setup(B,{emit:R}){const k=B,O=R,{courses:z}=ne(),{ensureFolder:G}=se(),g=D(null),s=D({title:"",description:"",dueDate:"",courseId:null,priority:"Sedang",attachments:[]});re(()=>k.isOpen,u=>{u&&k.initialData?s.value={...k.initialData,attachments:[...k.initialData.attachments||[]]}:u&&(s.value={title:"",description:"",dueDate:"",courseId:null,priority:"Sedang",attachments:[]})});const w=()=>{var u;return(u=g.value)==null?void 0:u.click()},C=async u=>{const a=u.target.files;if(!(!a||a.length===0)){for(let n=0;n<a.length;n++){const f=a[n];if(f.size>50*1024*1024){(await X.create({message:"File ".concat(f.name," terlalu besar (Maks 50MB)"),duration:3e3,color:"danger"})).present();continue}const h=new FileReader;h.readAsDataURL(f),h.onload=async()=>{const N=h.result.split(",")[1],o=Date.now()+"_"+n+"_"+f.name;try{await G(),await $.writeFile({path:"NyatetTugas/".concat(o),data:N,directory:F.Documents}),s.value.attachments.push({filePath:o,fileName:f.name,fileType:f.type})}catch(i){console.error("Gagal simpan file:",i)}}}g.value&&(g.value.value="")}},P=async u=>{try{const a=await $.readFile({path:"NyatetTugas/".concat(u.filePath),directory:F.Documents});await $.writeFile({path:u.filePath,data:a.data,directory:F.Cache});const n=await $.getUri({path:u.filePath,directory:F.Cache});await Oe.open({filePath:n.uri,contentType:u.fileType})}catch(a){(await X.create({message:"Gagal membuka file.",duration:2e3,color:"danger"})).present()}},A=async u=>{const a=s.value.attachments[u];try{await $.deleteFile({path:"NyatetTugas/".concat(a.filePath),directory:F.Documents}),console.log("File fisik berhasil dihapus dari storage")}catch(n){console.error("Gagal menghapus file fisik atau file tidak ditemukan:",n)}s.value.attachments.splice(u,1)},H=u=>u.length>15?u.substring(0,12)+"...":u,M=()=>O("save",s.value);return(u,a)=>(p(),I(e(de),{"is-open":B.isOpen,onDidDismiss:a[6]||(a[6]=n=>u.$emit("close"))},{default:l(()=>[t(e(j),null,{default:l(()=>[t(e(q),{color:"primary"},{default:l(()=>[t(e(ee),null,{default:l(()=>[d(T(B.editingId?"Edit Tugas":"Tugas Baru"),1)]),_:1}),t(e(te),{slot:"end"},{default:l(()=>[t(e(U),{onClick:a[0]||(a[0]=n=>u.$emit("close"))},{default:l(()=>[...a[7]||(a[7]=[d("Batal",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ae),{class:"ion-padding bg-light"},{default:l(()=>[t(e(S),{class:"input-item"},{default:l(()=>[t(e(x),{position:"stacked"},{default:l(()=>[...a[8]||(a[8]=[d("Judul Tugas ",-1),m("span",{class:"text-danger"},"*",-1)])]),_:1}),t(e(J),{modelValue:s.value.title,"onUpdate:modelValue":a[1]||(a[1]=n=>s.value.title=n),placeholder:"Contoh: Makalah Kelompok"},null,8,["modelValue"])]),_:1}),t(e(ce),{class:"ion-no-padding"},{default:l(()=>[t(e(pe),null,{default:l(()=>[t(e(K),{size:"6"},{default:l(()=>[t(e(S),{class:"input-item"},{default:l(()=>[t(e(x),{position:"stacked"},{default:l(()=>[...a[9]||(a[9]=[d("Mata Kuliah",-1)])]),_:1}),t(e(Q),{modelValue:s.value.courseId,"onUpdate:modelValue":a[2]||(a[2]=n=>s.value.courseId=n),placeholder:"Pilih",interface:"popover"},{default:l(()=>[t(e(V),{value:null},{default:l(()=>[...a[10]||(a[10]=[d("Umum",-1)])]),_:1}),(p(!0),_(E,null,W(e(z),n=>(p(),I(e(V),{key:n.id,value:n.id},{default:l(()=>[d(T(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(e(K),{size:"6"},{default:l(()=>[t(e(S),{class:"input-item"},{default:l(()=>[t(e(x),{position:"stacked"},{default:l(()=>[...a[11]||(a[11]=[d("Prioritas",-1)])]),_:1}),t(e(Q),{modelValue:s.value.priority,"onUpdate:modelValue":a[3]||(a[3]=n=>s.value.priority=n),interface:"popover"},{default:l(()=>[t(e(V),{value:"Tinggi"},{default:l(()=>[...a[12]||(a[12]=[d("Tinggi",-1)])]),_:1}),t(e(V),{value:"Sedang"},{default:l(()=>[...a[13]||(a[13]=[d("Sedang",-1)])]),_:1}),t(e(V),{value:"Rendah"},{default:l(()=>[...a[14]||(a[14]=[d("Rendah",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(S),{class:"input-item"},{default:l(()=>[t(e(x),{position:"stacked"},{default:l(()=>[...a[15]||(a[15]=[d("Tenggat Waktu",-1)])]),_:1}),t(e(J),{type:"date",modelValue:s.value.dueDate,"onUpdate:modelValue":a[4]||(a[4]=n=>s.value.dueDate=n)},null,8,["modelValue"])]),_:1}),m("div",Pe,[a[16]||(a[16]=m("label",{class:"rich-label"},"Catatan & Lampiran",-1)),m("div",Me,[t(e(me),{modelValue:s.value.description,"onUpdate:modelValue":a[5]||(a[5]=n=>s.value.description=n),rows:4,placeholder:"Tulis detail tugas di sini...",class:"custom-textarea"},null,8,["modelValue"]),s.value.attachments.length>0?(p(),_("div",Ne,[(p(!0),_(E,null,W(s.value.attachments,(n,f)=>(p(),_("div",{key:f,class:"file-chip",onClick:h=>P(n)},[t(e(y),{icon:n.fileType.startsWith("image/")?e(ge):e(ve),class:"chip-icon"},null,8,["icon"]),m("span",Le,T(H(n.fileName)),1),m("div",{class:"chip-delete",onClick:ye(h=>A(f),["stop"])},[t(e(y),{icon:e(he),color:"danger"},null,8,["icon"])],8,Re)],8,Ue))),128))])):L("",!0),m("div",ze,[t(e(U),{fill:"clear",size:"small",onClick:w},{default:l(()=>[t(e(y),{slot:"icon-only",icon:e(le)},null,8,["icon"])]),_:1}),s.value.attachments.length===0?(p(),_("span",Ge,"Tambahkan foto atau dokumen...")):L("",!0)])])]),m("input",{type:"file",multiple:"",ref_key:"fileInputRef",ref:g,onChange:C,style:{display:"none"}},null,544),t(e(U),{expand:"block",class:"ion-margin-top btn-save",onClick:M,disabled:!s.value.title},{default:l(()=>[t(e(y),{slot:"start",icon:e(fe)},null,8,["icon"]),a[17]||(a[17]=d(" Simpan Tugas ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1},8,["is-open"]))}}),He=oe(Ae,[["__scopeId","data-v-dc85763b"]]),qe={slot:"end",class:"meta-end"},We={key:1,class:"empty-state"},Ee=Z({__name:"Tab2Page",setup(B){const{tasks:R,addTask:k,updateTask:O,deleteTask:z}=se(),{courses:G}=ne(),g=D(!1),s=D(null),w=D(null),C=D(""),P=Ie(()=>{let o=[...R.value];if(C.value){const i=C.value.toLowerCase();o=o.filter(c=>c.title.toLowerCase().includes(i)||c.description&&c.description.toLowerCase().includes(i))}return o.sort((i,c)=>{if(i.completed!==c.completed)return i.completed?1:-1;const r=b=>b==="Tinggi"?3:b==="Sedang"?2:1,v=b=>{if(!b)return 999;const ue=new Date(b).getTime()-new Date().getTime();return Math.ceil(ue/(1e3*3600*24))},ie=r(i.priority)*10-v(i.dueDate);return r(c.priority)*10-v(c.dueDate)-ie})}),A=o=>{const i=G.value.find(c=>c.id===o);return i?i.name:"Umum"},H=o=>o==="Tinggi"?"danger":o==="Sedang"?"warning":"success",M=o=>{if(!o)return{label:"",color:"medium"};const i=new Date;i.setHours(0,0,0,0);const c=new Date(o);c.setHours(0,0,0,0);const r=c.getTime()-i.getTime(),v=Math.ceil(r/(1e3*60*60*24));return v<0?{label:"Terlewat",color:"danger"}:v===0?{label:"Hari Ini",color:"warning"}:v===1?{label:"Besok",color:"primary"}:{label:u(o),color:"medium"}},u=o=>{if(!o)return"";const i={day:"numeric",month:"short"};return new Date(o).toLocaleDateString("id-ID",i)},a=()=>{s.value=null,w.value=null,g.value=!0},n=o=>{s.value=o.id,w.value=o,g.value=!0},f=o=>{s.value?O(s.value,o):k(o),g.value=!1},h=o=>z(o),N=o=>{O(o.id,{completed:!o.completed})};return(o,i)=>{const c=we("ion-text");return p(),I(e(_e),null,{default:l(()=>[t(e(j),null,{default:l(()=>[t(e(q),null,{default:l(()=>[t(e(ee),null,{default:l(()=>[...i[2]||(i[2]=[d("Daftar Tugas",-1)])]),_:1}),t(e(te),{slot:"end"},{default:l(()=>[t(e(U),{onClick:a},{default:l(()=>[t(e(y),{icon:e(Te),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),t(e(q),null,{default:l(()=>[t(e(ke),{modelValue:C.value,"onUpdate:modelValue":i[0]||(i[0]=r=>C.value=r),placeholder:"Cari tugas...",class:"simple-search"},null,8,["modelValue"])]),_:1})]),_:1}),t(e(ae),{class:"ion-padding"},{default:l(()=>[P.value.length>0?(p(),I(e(Ce),{key:0},{default:l(()=>[(p(!0),_(E,null,W(P.value,r=>(p(),I(e(be),{key:r.id},{default:l(()=>[t(e(S),null,{default:l(()=>[t(e(Ve),{slot:"start",checked:r.completed,onIonChange:v=>N(r)},null,8,["checked","onIonChange"]),t(e(x),{class:"ion-text-wrap"},{default:l(()=>[m("h2",null,T(r.title),1),m("p",null,[d(T(A(r.courseId))+" ",1),r.dueDate?(p(),I(c,{key:0,color:M(r.dueDate).color},{default:l(()=>[d(" â€¢ "+T(M(r.dueDate).label),1)]),_:2},1032,["color"])):L("",!0)])]),_:2},1024),m("div",qe,[r.attachments&&r.attachments.length>0?(p(),I(e(y),{key:0,icon:e(le),color:"medium",size:"small",style:{"margin-right":"8px"}},null,8,["icon"])):L("",!0),t(e($e),{color:H(r.priority)},{default:l(()=>[d(T(r.priority),1)]),_:2},1032,["color"])])]),_:2},1024),t(e(Fe),{side:"end"},{default:l(()=>[t(e(Y),{color:"primary",onClick:v=>n(r)},{default:l(()=>[t(e(y),{icon:e(Se),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"]),t(e(Y),{color:"danger",onClick:v=>h(r.id)},{default:l(()=>[t(e(y),{icon:e(xe),slot:"icon-only"},null,8,["icon"])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(p(),_("div",We,[t(e(y),{icon:e(De),class:"large-icon"},null,8,["icon"]),i[3]||(i[3]=m("p",null,"Belum ada tugas.",-1))])),t(He,{"is-open":g.value,"editing-id":s.value,"initial-data":w.value,onClose:i[1]||(i[1]=r=>g.value=!1),onSave:f},null,8,["is-open","editing-id","initial-data"])]),_:1})]),_:1})}}}),Ye=oe(Ee,[["__scopeId","data-v-09ae5eb3"]]);export{Ye as default};
